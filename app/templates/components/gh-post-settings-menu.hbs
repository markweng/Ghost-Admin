<div class="settings-menu-container">
    <div id="entry-controls">
        <div class="{{if isViewingSubview 'settings-menu-pane-out-left' 'settings-menu-pane-in'}} settings-menu settings-menu-pane">
            <div class="settings-menu-header">
                <h4>设置</h4>
                <button class="close settings-menu-header-action" {{action "closeMenus" target=ui}} data-test-close-settings-menu>
                    {{svg-jar "close"}}<span class="hidden">Close</span>
                </button>
            </div>
            <div class="settings-menu-content">
                {{gh-image-uploader-with-preview
                    image=post.featureImage
                    text=(concat "上传一张图片")
                    allowUnsplash=true
                    update=(action "setCoverImage")
                    remove=(action "clearCoverImage")
                }}
                <form>
                <div class="form-group">
                    <label for="url">链接</label>
                    {{!-- new posts don't have a preview link --}}
                    {{#unless post.isNew}}
                        {{#if post.isPublished}}
                        <a class="post-view-link" target="_blank" href="{{post.url}}">
                            预览 {{svg-jar "external"}}
                        </a>
                        {{else}}
                        <a class="post-view-link" target="_blank" href="{{post.previewUrl}}">
                            预览 {{svg-jar "external"}}
                        </a>
                        {{/if}}
                    {{/unless}}

                    <div class="gh-input-icon gh-icon-link">
                        {{svg-jar "link"}}
                        {{gh-text-input
                            class="post-setting-slug"
                            id="url"
                            name="post-setting-slug"
                            value=(readonly slugValue)
                            input=(action (mut slugValue) value="target.value")
                            focus-out=(action "updateSlug" slugValue)
                            stopEnterKeyDownPropagation=true}}
                    </div>
                    {{gh-url-preview slug=slugValue tagName="p" classNames="description"}}
                </div>

                <div class="form-group">
                    {{#if (or post.isDraft post.isPublished post.pastScheduledTime)}}
                        <label>公开时间</label>
                    {{else}}
                        <label>计划时间</label>
                    {{/if}}
                    {{gh-date-time-picker
                        date=post.publishedAtBlogDate
                        time=post.publishedAtBlogTime
                        setDate=(action "setPublishedAtBlogDate")
                        setTime=(action "setPublishedAtBlogTime")
                        errors=post.errors
                        dateErrorProperty="publishedAtBlogDate"
                        timeErrorProperty="publishedAtBlogTime"
                        maxDate='now'
                        disabled=post.isScheduled
                        static=true
                    }}
                    {{#unless (or post.isDraft post.isPublished post.pastScheduledTime)}}
                    {{/unless}}
                </div>

                {{#unless session.user.isContributor}}
                <div class="form-group">
                    <label for="tag-input">类型</label>
                    {{gh-psm-tags-input post=post triggerId="tag-input"}}
                </div>
                {{/unless}}


                {{#if feature.members}}
                    {{#if showVisibilityInput}}
                        <div class="form-group">
                            <label for="visibility-input">Post access</label>
                            {{gh-psm-visibility-input post=post triggerId="visibility-input"}}
                        </div>
                    {{/if}}
                {{/if}}


                {{#gh-form-group errors=post.errors hasValidated=post.hasValidated property="customExcerpt"}}
                    <label for="custom-excerpt">摘录</label>
                    {{gh-textarea
                        class="post-setting-custom-excerpt"
                        id="custom-excerpt"
                        name="post-setting-custom-excerpt"
                        value=(readonly customExcerptScratch)
                        input=(action (mut customExcerptScratch) value="target.value")
                        focus-out=(action "setCustomExcerpt" customExcerptScratch)
                        stopEnterKeyDownPropagation="true"
                        data-test-field="custom-excerpt"}}
                    {{gh-error-message errors=post.errors property="customExcerpt" data-test-error="custom-excerpt"}}
                {{/gh-form-group}}

                {{#unless session.user.isAuthorOrContributor}}
                    {{#gh-form-group class="for-select" errors=post.errors hasValidated=post.hasValidated property="authors" data-test-input="authors"}}
                        <label for="author-list">编辑者</label>
                        {{gh-psm-authors-input selectedAuthors=post.authors updateAuthors=(action "changeAuthors") triggerId="author-list"}}
                        {{gh-error-message errors=post.errors property="authors" data-test-error="authors"}}
                    {{/gh-form-group}}
                {{/unless}}

         

                {{#unless this.session.user.isAuthorOrContributor}}
                <div class="form-group for-checkbox">
                    <label class="checkbox" for="featured" {{action "toggleFeatured" bubbles="false"}}>
                        <input
                            type="checkbox"
                            checked={{post.featured}}
                            class="gh-input post-settings-featured"
                            onclick={{action (mut post.featured) value="target.checked"}}
                            data-test-checkbox="featured"
                        >
                        <span class="input-toggle-component"></span>
                        <p>设置为特色页面</p>
                    </label>
                </div>
                {{/unless}}

                {{gh-psm-template-select
                    post=post
                    onTemplateSelect=(action (mut post.customTemplate))}}

                {{#unless post.isNew}}
                    <button type="button" class="gh-btn gh-btn-hover-red gh-btn-icon settings-menu-delete-button" {{action "deletePost"}}><span>{{svg-jar "trash"}} 删除 </span></button>
                {{/unless}}

                </form>
            </div>{{! .settings-menu-content }}
        </div>{{! .post-settings-menu }}

      
    </div>
</div>

{{!--
    _showThrobbers is on a timer so that throbbers don't get positioned until
    the slide-in animation has finished and it gets toggled when the meta
    pane is shown
--}}
{{#if _showThrobbers}}
    {{#unless this.session.user.isAuthorOrContributor}}
        {{gh-tour-item "featured-post"
            target="label[for='featured'] p"
            throbberAttachment="middle middle"
            throbberOffset="0px -20px"
            popoverTriangleClass="bottom-right"
        }}
    {{/unless}}
{{/if}}
